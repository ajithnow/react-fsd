# üèõÔ∏è Feature-Sliced Design (FSD) Architecture

## Current Implementation Status

This document describes the implemented FSD architecture with focus on layouts, guards, authentication patterns, and modern React practices.

## Technology Stack

- **Node.js** 20+ (LTS)
- **React** 19+ with modern features
- **TypeScript** 5.8+ with strict configuration
- **Vite** 7+ for build tooling
- **TailwindCSS** 4+ for styling
- **TanStack Router** for type-safe routing
- **TanStack Query** for server state management
- **Zustand** for client state management
- **Jest** + **React Testing Library** for testing
- **MSW** for API mocking

## Architecture Layers

### üéØ **Core Layer** - Application Infrastructure

**Purpose**: Framework-agnostic foundational logic and app-level concerns

````text
core/
‚îú‚îÄ‚îÄ api/                  # API client configuration
‚îÇ   ‚îî‚îÄ‚îÄ index.ts         # Axios setup, interceptors
‚îú‚îÄ‚îÄ components/          # App-level components
‚îú‚îÄ‚îÄ i18n/               # Internationalization setup
‚îÇ   ‚îî‚îÄ‚îÄ index.ts        # i18next configuration
‚îú‚îÄ‚îÄ layouts/            # Application layout wrappers
‚îÇ   ‚îú‚îÄ‚îÄ GlobalLayout.tsx # Global app concerns (providers, analytics)
‚îÇ   ‚îú‚îÄ‚îÄ LayoutWrapper.tsx # Layout composition
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ mock/               # MSW configuration
‚îÇ   ‚îî‚îÄ‚îÄ browser.ts      # Service worker setup
‚îú‚îÄ‚îÄ models/             # Core type definitions
‚îÇ   ‚îî‚îÄ‚îÄ layout.model.ts # Layout interfaces
‚îî‚îÄ‚îÄ router/             # Router configuration
    ‚îî‚îÄ‚îÄ index.tsx       # TanStack Router setup

**Key Principle**: No business logic, only foundational services.

### üöÄ **Features Layer** - Business Logic

**Purpose**: Self-contained business features with their own guards, layouts, and logic

```text
features/
‚îú‚îÄ‚îÄ auth/                # Authentication feature
‚îÇ   ‚îú‚îÄ‚îÄ components/      # Login forms, auth UI
‚îÇ   ‚îú‚îÄ‚îÄ constants/       # Auth-related constants
‚îÇ   ‚îú‚îÄ‚îÄ guards/          # AuthGuard, GuestGuard
‚îÇ   ‚îú‚îÄ‚îÄ layouts/         # AuthLayout for auth pages
‚îÇ   ‚îú‚îÄ‚îÄ locales/         # Auth translations
‚îÇ   ‚îú‚îÄ‚îÄ managers/        # Auth business logic
‚îÇ   ‚îú‚îÄ‚îÄ mocks/           # MSW handlers for auth
‚îÇ   ‚îú‚îÄ‚îÄ models/          # Auth types and interfaces
‚îÇ   ‚îú‚îÄ‚îÄ pages/           # Login, Register pages
‚îÇ   ‚îú‚îÄ‚îÄ queries/         # TanStack Query hooks
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # Auth route definitions
‚îÇ   ‚îú‚îÄ‚îÄ schema/          # Validation schemas
‚îÇ   ‚îú‚îÄ‚îÄ services/        # Auth API services
‚îÇ   ‚îú‚îÄ‚îÄ stores/          # Auth state management
‚îÇ   ‚îî‚îÄ‚îÄ utils/           # Auth utilities
‚îú‚îÄ‚îÄ home/                # Home feature
‚îÇ   ‚îú‚îÄ‚îÄ constants/       # Home constants
‚îÇ   ‚îú‚îÄ‚îÄ guards/          # Home-specific guards
‚îÇ   ‚îî‚îÄ‚îÄ routes/          # Home routes
‚îú‚îÄ‚îÄ configs.ts           # Feature configuration aggregation
‚îú‚îÄ‚îÄ guards.tsx           # Cross-feature guard utilities
‚îú‚îÄ‚îÄ locales.ts           # Locale aggregation
‚îú‚îÄ‚îÄ mocks.ts             # Mock aggregation
‚îî‚îÄ‚îÄ routes.ts            # Route aggregation
````

### ü§ù **Shared Layer** - Common Resources

**Purpose**: Reusable utilities and types used across features

```
shared/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ common.model.ts   # Guard interfaces, common types
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ common.utils.ts   # generateGuards, generateResources
‚îî‚îÄ‚îÄ pages/
    ‚îî‚îÄ‚îÄ HomePage/         # Shared page components
```

## üõ°Ô∏è Guard System Implementation

### Architecture Philosophy

Guards follow FSD principles by living within their respective features, with shared types in the shared layer.

**Location Strategy**:

- `features/auth/guards/` - Auth-specific guards (AuthGuard, GuestGuard)
- `shared/models/common.model.ts` - Common guard interfaces
- `features/guards.tsx` - Optional cross-feature aggregation

### Usage Patterns

#### Direct Feature Imports (Recommended)

```typescript
// Within auth feature
import { GuestGuard } from '../guards';

// Cross-feature usage
import { AuthGuard } from '@/features/auth/guards';

// Route implementation
const homeRoute = createRoute({
  component: () => (
    <AuthGuard>
      <HomePage />
    </AuthGuard>
  ),
});
```

## üé® Layout System Implementation

### Layout Hierarchy

1. **GlobalLayout** - App-level concerns (analytics, providers, error boundaries)
2. **AuthLayout** - Auth-specific visual structure (branding, forms)
3. **Feature Layouts** - Feature-specific UI patterns

### GlobalLayout Simplification

**Philosophy**: GlobalLayout should handle global concerns, not visual layout.

```typescript
// Before: Mixed visual + global concerns
<div className="min-h-screen">
  <header>...</header>
  <main>{children}</main>
  <footer>...</footer>
</div>

// After: Pure global concerns
<>
  {/* TODO: Analytics, Error Boundaries, Providers */}
  {children}
</>
```

**Benefits**:

- ‚úÖ Separation of concerns
- ‚úÖ Visual layout flexibility per feature
- ‚úÖ Easier testing and maintenance
- ‚úÖ Ready for analytics/monitoring integration

graph TD
subgraph "Application Architecture"
subgraph "Features Layer (Business Logic)"
F1[üë§ Auth Feature]
F2[üìä Dashboard Feature]
F3[‚öôÔ∏è Settings Feature]
F4[üîç Search Feature]
end

        subgraph "Shared Layer (Common Resources)"
            S1[ü§ù Shared Components]
            S2[üõ†Ô∏è Shared Utils]
            S3[üìù Shared Models]
            S4[üíæ Shared Stores]
        end

        subgraph "Core Layer (App Infrastructure)"
            C1[üåê Router]
            C2[üîó API Client]
            C3[üåç i18n]
            C4[üß™ MSW Config]
        end

        subgraph "Lib Layer (External Adaptations)"
            L1[üé® ShadCN UI]
            L2[üìö Utils]
            L3[üé≠ Theme]
        end
    end

    %% Dependencies (downward only)
    F1 --> S1
    F1 --> S2
    F1 --> S3
    F2 --> S1
    F2 --> S4
    F3 --> S2
    F4 --> S1

    F1 --> C1
    F2 --> C2
    F3 --> C3

    S1 --> L1
    S2 --> L2
    C1 --> L1

    %% Styling
    classDef featureLayer fill:#e1f5fe,stroke:#0288d1,stroke-width:2px
    classDef sharedLayer fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef coreLayer fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef libLayer fill:#fff3e0,stroke:#f57c00,stroke-width:2px

    class F1,F2,F3,F4 featureLayer
    class S1,S2,S3,S4 sharedLayer
    class C1,C2,C3,C4 coreLayer
    class L1,L2,L3 libLayer

````

## Feature Internal Structure

Each feature follows a consistent internal structure for predictability and maintainability.

```mermaid
graph TD
    subgraph "Feature: Auth"
        subgraph "UI Layer"
            A1[üì± Components]
            A2[üìÑ Pages]
        end

        subgraph "Business Logic"
            A3[üß† Managers]
            A4[üíæ Stores]
            A5[üîç Queries]
        end

        subgraph "Data Layer"
            A6[üåê Services]
            A7[üìã Schema]
            A8[üìä Models]
        end

        subgraph "Configuration"
            A9[üó∫Ô∏è Routes]
            A10[üîß Constants]
            A11[üåç Locales]
        end

        subgraph "Development"
            A12[üé≠ Mocks]
            A13[üß™ Tests]
        end
    end

    %% Internal dependencies
    A1 --> A3
    A1 --> A4
    A1 --> A5
    A2 --> A1
    A2 --> A3
    A3 --> A6
    A3 --> A4
    A5 --> A6
    A6 --> A7
    A6 --> A8
    A9 --> A2
    A13 --> A12

    %% Styling
    classDef uiLayer fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    classDef businessLayer fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef dataLayer fill:#ffcdd2,stroke:#d32f2f,stroke-width:2px
    classDef configLayer fill:#f8bbd9,stroke:#c2185b,stroke-width:2px
    classDef devLayer fill:#ffe0b2,stroke:#f57c00,stroke-width:2px

    class A1,A2 uiLayer
    class A3,A4,A5 businessLayer
    class A6,A7,A8 dataLayer
    class A9,A10,A11 configLayer
    class A12,A13 devLayer
````

## Data Flow Architecture

This diagram shows how data flows through the application layers with proper separation of concerns.

```mermaid
sequenceDiagram
    participant U as üë§ User
    participant C as üì± Component
    participant M as üß† Manager
    participant S as üíæ Store
    participant Q as üîç Query
    participant API as üåê Service
    participant BE as üè¢ Backend

    U->>C: User Action (e.g., Login)
    C->>M: Call Manager Method
    M->>S: Update Loading State
    M->>Q: Trigger Query
    Q->>API: API Call
    API->>BE: HTTP Request
    BE-->>API: Response Data
    API-->>Q: Processed Data
    Q-->>M: Query Result
    M->>S: Update State
    S-->>C: State Change
    C-->>U: UI Update

    Note over C,API: All layers follow FSD dependency rules
    Note over S: Global state accessible by components
    Note over Q: Server state managed separately
```

## Cross-Feature Communication

Demonstrates how features communicate through the shared layer, maintaining architectural boundaries.

```mermaid
graph LR
    subgraph "Feature A (Auth)"
        A1[Login Component]
        A2[Auth Store]
        A3[Auth Manager]
    end

    subgraph "Shared Layer"
        S1[App Store]
        S2[User Utils]
        S3[Event Bus]
    end

    subgraph "Feature B (Dashboard)"
        B1[Dashboard Component]
        B2[Dashboard Store]
        B3[User Profile]
    end

    %% Correct communication through shared layer
    A2 --> S1
    A3 --> S2
    S1 --> B2
    S2 --> B3
    S3 --> B1

    %% Forbidden direct communication
    A2 -.->|‚ùå Forbidden| B2
    A1 -.->|‚ùå Forbidden| B1

    classDef featureA fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef featureB fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef shared fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef forbidden stroke:#d32f2f,stroke-width:2px,stroke-dasharray: 5 5

    class A1,A2,A3 featureA
    class B1,B2,B3 featureB
    class S1,S2,S3 shared
```

## Technology Stack Integration

Shows how different technologies integrate within the FSD architecture.

```mermaid
graph TB
    subgraph "Frontend Stack"
        subgraph "UI Layer"
            React[‚öõÔ∏è React 19]
            TS[üìò TypeScript 5.8]
            ShadCN[üé® ShadCN UI]
            Tailwind[üí® Tailwind CSS]
        end

        subgraph "State Management"
            Zustand[üêª Zustand]
            TanQuery[üîç TanStack Query]
            RHF[üìù React Hook Form]
        end

        subgraph "Routing & Navigation"
            Router[üó∫Ô∏è TanStack Router]
            i18n[üåç react-i18next]
        end

        subgraph "Development Tools"
            Vite[‚ö° Vite]
            Jest[üß™ Jest]
            RTL[üî¨ React Testing Library]
            MSW[üé≠ MSW]
            ESLint[üìè ESLint]
        end
    end

    %% Integration connections
    React --> ShadCN
    React --> RHF
    TS --> React
    Zustand --> React
    TanQuery --> React
    Router --> React
    i18n --> React
    Tailwind --> ShadCN
    Jest --> RTL
    MSW --> Jest
    Vite --> React

    classDef ui fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef state fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef routing fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef dev fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px

    class React,TS,ShadCN,Tailwind ui
    class Zustand,TanQuery,RHF state
    class Router,i18n routing
    class Vite,Jest,RTL,MSW,ESLint dev
```

## Development Workflow

Illustrates the typical development workflow when working with this architecture.

```mermaid
flowchart TD
    Start([üöÄ Start Development]) --> Plan{üìã Plan Feature}
    Plan --> Structure[üìÅ Create Feature Structure]
    Structure --> Models[üìä Define Models & Types]
    Models --> Services[üåê Implement Services]
    Services --> Stores[üíæ Create Stores]
    Stores --> Components[üì± Build Components]
    Components --> Pages[üìÑ Create Pages]
    Pages --> Routes[üó∫Ô∏è Configure Routes]
    Routes --> Tests[üß™ Write Tests]
    Tests --> Integration[üîó Register Feature]
    Integration --> Review{üëÄ Code Review}
    Review -->|‚ùå Issues| Fix[üîß Fix Issues]
    Fix --> Review
    Review -->|‚úÖ Approved| Deploy[üöÄ Deploy]

    %% Parallel processes
    Models --> Mocks[üé≠ Create Mocks]
    Mocks --> Tests
    Services --> Locales[üåç Add Locales]
    Locales --> Components

    classDef startEnd fill:#c8e6c9,stroke:#388e3c,stroke-width:3px
    classDef process fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    classDef decision fill:#ffcdd2,stroke:#d32f2f,stroke-width:2px
    classDef parallel fill:#f8bbd9,stroke:#c2185b,stroke-width:2px

    class Start,Deploy startEnd
    class Structure,Models,Services,Stores,Components,Pages,Routes,Tests,Integration,Fix process
    class Plan,Review decision
    class Mocks,Locales parallel
```

## Build & Configuration Architecture

### Modern Toolchain Setup

This project uses a modern, optimized toolchain designed for performance and developer experience:

#### Build Configuration (Vite 7+)

```typescript
// vite.config.ts - Modern build setup
export default defineConfig({
  plugins: [
    react(), // React support with Fast Refresh
    tailwindcss(), // TailwindCSS 4+ integration
  ],
  server: {
    port: 3000, // Consistent dev server port
    open: true, // Auto-open browser
  },
  resolve: {
    alias: {
      // Path mapping for clean imports
      '@': path.resolve(__dirname, './src'),
      components: path.resolve(__dirname, './src/components'),
      features: path.resolve(__dirname, './src/features'),
      core: path.resolve(__dirname, './src/core'),
    },
  },
});
```

#### TypeScript Configuration (5.8+)

```json
// tsconfig.json - Strict TypeScript setup
{
  "compilerOptions": {
    "target": "ES2022", // Modern JavaScript target
    "lib": ["ES2022", "DOM"], // Modern APIs
    "module": "ESNext", // ESM modules
    "moduleResolution": "bundler", // Vite-optimized resolution
    "strict": true, // Strict type checking
    "noUnusedLocals": true, // Enforce clean code
    "jsx": "react-jsx" // Modern JSX transform
  }
}
```

#### Package Configuration

```json
// package.json - Node 20+ requirement
{
  "type": "module", // ESM-first approach
  "engines": {
    "node": ">=20.0.0", // Node 20+ requirement
    "npm": ">=10.0.0" // npm 10+ requirement
  }
}
```

### Testing Architecture

- **Jest 30+** - Modern testing framework
- **React Testing Library 16+** - Component testing
- **MSW 2+** - API mocking
- **80% coverage** - Quality threshold

### Code Quality Pipeline

- **ESLint 9+** - Modern linting with flat config
- **Prettier 3+** - Code formatting
- **Husky** - Git hooks
- **TypeScript strict mode** - Type safety
